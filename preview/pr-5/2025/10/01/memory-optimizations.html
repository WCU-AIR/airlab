<!DOCTYPE html>
<html lang="en" data-dark="false">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--
  put your analytics (e.g. Google Analytics) tracking code here
-->

  <!--
  put your search engine verification (e.g. Google Search Console) tag here
-->

  






























<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Memory Optimization Demo | WCU-AIR</title>

<link rel="icon" href="/airlab/preview/pr-5/images/icon.png">

<meta name="title" content="Memory Optimization Demo">
<meta name="description" content="The Artificial Intelligence Research (AIR) Lab at West Chester University is a collaborative community of faculty and students exploring how AI can make a positive impact. We bring together diverse computer science, engineering, and education perspectives, with a strong emphasis on mentorship and hands-on experience. Our members contribute to publications, open-source projects, and applied collaborations while developing skills that prepare them for both academic and industry careers. By fostering inclusion and curiosity, the AIR Lab provides an environment where innovation and learning thrive side by side.">

<meta property="og:title" content="Memory Optimization Demo">
<meta property="og:site_title" content="WCU-AIR">
<meta property="og:description" content="The Artificial Intelligence Research (AIR) Lab at West Chester University is a collaborative community of faculty and students exploring how AI can make a positive impact. We bring together diverse computer science, engineering, and education perspectives, with a strong emphasis on mentorship and hands-on experience. Our members contribute to publications, open-source projects, and applied collaborations while developing skills that prepare them for both academic and industry careers. By fostering inclusion and curiosity, the AIR Lab provides an environment where innovation and learning thrive side by side.">
<meta property="og:url" content="/airlab/preview/pr-5">
<meta property="og:image" content="/airlab/preview/pr-5/images/share.jpg">
<meta property="og:locale" content="en_US">

<meta property="twitter:title" content="Memory Optimization Demo">
<meta property="twitter:description" content="The Artificial Intelligence Research (AIR) Lab at West Chester University is a collaborative community of faculty and students exploring how AI can make a positive impact. We bring together diverse computer science, engineering, and education perspectives, with a strong emphasis on mentorship and hands-on experience. Our members contribute to publications, open-source projects, and applied collaborations while developing skills that prepare them for both academic and industry careers. By fostering inclusion and curiosity, the AIR Lab provides an environment where innovation and learning thrive side by side.">
<meta property="twitter:url" content="/airlab/preview/pr-5">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="/airlab/preview/pr-5/images/share.jpg">


  <meta name="author" content="brian-kominick">
  <meta property="og:type" content="article">
  <meta property="og:updated_time" content="2025-10-08T23:09:14+00:00">
  <meta property="article:published_time" content="2025-10-01T00:00:00+00:00">
  <meta property="article:modified_time" content="2025-10-08T23:09:14+00:00">
  <meta name="revised" content="2025-10-08T23:09:14+00:00">


<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "BlogPosting",
      "author": { "@type": "Person", "name": "Memory Optimization Demo" },
      "datePublished": "2025-10-01T00:00:00+00:00",
      "dateModified": "2025-10-08T23:09:14+00:00",
    
    "name": "Memory Optimization Demo",
    "description": "The Artificial Intelligence Research (AIR) Lab at West Chester University is a collaborative community of faculty and students exploring how AI can make a positive impact. We bring together diverse computer science, engineering, and education perspectives, with a strong emphasis on mentorship and hands-on experience. Our members contribute to publications, open-source projects, and applied collaborations while developing skills that prepare them for both academic and industry careers. By fostering inclusion and curiosity, the AIR Lab provides an environment where innovation and learning thrive side by side.",
    "headline": "Memory Optimization Demo",
    "publisher": {
      "@type": "Organization",
      "logo": { "@type": "ImageObject", "url": "/airlab/preview/pr-5/images/icon.png" }
    },
    "url": "/airlab/preview/pr-5"
  }
</script>

<link rel="alternate" type="application/rss+xml" href="/airlab/preview/pr-5/feed.xml">

  <!-- Google Fonts -->
<!-- automatically get url from fonts used in theme file -->

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?display=swap&&family=Barlow:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Roboto+Mono:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600" rel="stylesheet">

<!-- Font Awesome icons (load asynchronously due to size) -->

<link href="https://use.fontawesome.com/releases/v6.7.0/css/all.css" rel="stylesheet" media="none" onload="this.removeAttribute('media'); this.onload = null;">
<noscript>
  <link href="https://use.fontawesome.com/releases/v6.7.0/css/all.css" rel="stylesheet">
</noscript>

  <!-- third party styles -->
<!-- https://stylishthemes.github.io/Syntax-Themes/pygments/ -->
<link href="https://cdn.jsdelivr.net/gh/StylishThemes/Syntax-Themes/pygments/css-github/pygments-tomorrow-night-eighties.css" rel="stylesheet">

<!-- include all sass in styles folder -->


  
    <link href="/airlab/preview/pr-5/_styles/-theme.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/alert.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/all.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/anchor.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/background.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/body.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/bold.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/button.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/card.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/checkbox.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/citation.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/code.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/cols.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/dark-toggle.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/details.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/feature.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/figure.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/float.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/font.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/footer.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/form.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/grid.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/header.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/heading.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/highlight.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/icon.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/image.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/link.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/list.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/main.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/paragraph.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/portrait.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/post-excerpt.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/post-info.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/post-nav.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/quote.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/rule.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/search-box.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/search-info.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/section.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/table.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/tags.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/textbox.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/tooltip.css" rel="stylesheet">
  

  
    <link href="/airlab/preview/pr-5/_styles/util.css" rel="stylesheet">
  


<!-- include all css in styles folder -->



  <!-- third party scripts -->
<script src="https://unpkg.com/@popperjs/core@2" defer></script>
<script src="https://unpkg.com/tippy.js@6" defer></script>
<script src="https://unpkg.com/mark.js@8" defer></script>

<!-- include all js in scripts folder -->


  <script src="/airlab/preview/pr-5/_scripts/anchors.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/dark-mode.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/fetch-tags.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/search.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/site-search.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/table-wrap.js"></script>

  <script src="/airlab/preview/pr-5/_scripts/tooltip.js"></script>


<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

  <body>
    







<header class="background" style="--image: url('/airlab/preview/pr-5/images/background.jpg')" data-dark="true">
  <a href="/airlab/preview/pr-5/" class="home">
    
      <span class="logo">
        
          <svg xmlns="http://www.w3.org/2000/svg" viewbox="-40 -60 80 100">
  <style>
    .bubble {
      animation: float 2s ease-out both infinite var(--delay);
    }
    @keyframes float {
      0% {
        opacity: 0;
      }
      50% {
        transform: translateY(0);
        opacity: 0;
      }
      75% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        transform: translateY(-40px);
      }
    }
  </style>
  <g fill="currentColor" opacity="0.5">
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 0.1s"></circle>
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 0.4s"></circle>
    <circle class="bubble" cx="0" cy="-10" r="3" style="--delay: 1.1s"></circle>
  </g>
  <path fill="#38bdf8" d="
      M 0 -22.5
      L -19.5 -11.25
      L -19.5 11.25
      L 0 22.5
      L 19.5 11.25
      L 19.5 -11.25
      z
    "></path>
  <path fill="#bae6fd" d="
      M 0 -22.5
      L -19.5 -11.25
      L 0 0
      L 19.5 -11.25
      z
    "></path>
  <path fill="none" stroke="currentColor" stroke-width="5" d="
      M -18 -53
      L -10 -53
      L -10 -29.2
      L -30.3 -17.5
      L -30.3 17.5
      L 0 35
      L 30.3 17.5
      L 30.3 -17.5
      L 10 -29.2
      L 10 -53
      L 18 -53
    "></path>
</svg>

        
      </span>
    
    
      <span class="title-text" data-tooltip="Home">
        
          <span class="title">WCU-AIR</span>
        
        
      </span>
    
  </a>

  <input class="nav-toggle" type="checkbox" aria-label="show/hide nav">

  <nav>
    
    
      
        <a href="/airlab/preview/pr-5/research/" data-tooltip="Published works">
          Research
        </a>
      
    
      
        <a href="/airlab/preview/pr-5/projects/" data-tooltip="Software, datasets, and more">
          Projects
        </a>
      
    
      
        <a href="/airlab/preview/pr-5/team/" data-tooltip="About our team">
          Team
        </a>
      
    
      
        <a href="/airlab/preview/pr-5/blog/" data-tooltip="Musings and miscellany">
          Blog
        </a>
      
    
      
        <a href="/airlab/preview/pr-5/contact/" data-tooltip="Email, address, and location">
          Contact
        </a>
      
    
  </nav>
</header>

    <main>
      <!--
  modify main content of page:
  - add section breaks
  - attach section properties
  - filter out blank sections
-->






  
  
  

  <section class="background" data-size="1" style="--image: url('/airlab/preview/pr-5/images/other/blogs/computing-resources/before.png')">
    <!--
  <background>images/other/blogs/computing-resources/before.png</background>
  <dark></dark>
  <size>1</size>
-->


<h1 class="center">Memory Optimization Demo</h1>

<div class="post-info">
  
    
    
      
      
        



<div class="portrait-wrapper">
  <a href="/airlab/preview/pr-5/members/brian-kominick.html" class="portrait" data-style="tiny" aria-label="Brian Kominick">
    

    <img src="/airlab/preview/pr-5/images/headshots/briank.jpg" class="portrait-image" alt="member portrait" loading="lazy" onerror="this.src = '/airlab/preview/pr-5/images/fallback.svg'; this.onerror = null;">

    
      <span class="portrait-name">
        Brian Kominick
      </span>
    

    
      <span class="portrait-description">
        Graduate
      </span>
    

    
  </a>
</div>

      
    
  

  
  

  
    <span data-tooltip="Originally published on">
      <i class="icon fa-regular fa-calendar"></i>
      <span>October 01, 2025</span>
    </span>
  

  
    <span data-tooltip="Last updated on">
      <i class="icon fa-solid fa-clock-rotate-left"></i>
      <span>October 08, 2025</span>
    </span>
  
</div>


  


  <div class="tags">
    
      <a href="/airlab/preview/pr-5/blog?search=%22tag:%20ai%22" class="tag" data-tooltip='Show items with the tag "ai"'>
        ai
      </a>
    
      <a href="/airlab/preview/pr-5/blog?search=%22tag:%20memory%22" class="tag" data-tooltip='Show items with the tag "memory"'>
        memory
      </a>
    
      <a href="/airlab/preview/pr-5/blog?search=%22tag:%20resources%22" class="tag" data-tooltip='Show items with the tag "resources"'>
        resources
      </a>
    
  </div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  <background></background>
  <dark></dark>
  <size></size>
-->


<h2 id="introduction">Introduction</h2>
<p>In my <a href="/airlab/preview/pr-5/blog/_posts/2025-09-20-computing-resources.html" title="Computing Resources Blog">“last blog post”</a>, we looked at some past and projected figures for AI’s natural-resource consumption and showed the expenditure to be immense. Following that, we gave a high-level view of current or proposed methods to mitigate those figures. In this blog post, we’ll inspect a couple current software-level optimizations (kernel fusion and gradient checkpointing) and implement some simple demos to deepen our understanding of how they work. Following that, I’ll give a brief reflection on what I’ve gained from writing this post and what I plan to do next.</p>

<h2 id="background">Background</h2>
<!-- excerpt start -->
<p>To pragmatically address the bottleneck of input/output operations, let’s look at a couple specific ways we can better utilize the computing resources we have available: kernel fusion and gradient checkpointing<!-- excerpt end --><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>. Before getting into their implementations, we’ll review each one conceptually.</p>

<h3 id="kernel-fusion">Kernel Fusion</h3>
<p>Since i/o operations to secondary memory are more computationally expensive, kernel fusion aims to reduce them by maximizing the potential of our primary memory. Before going any further, we should clarify what a kernel is. We can think of it as a function that is carried out by number of threads in parallel on a GPU. Somewhat analogous to combining multiple subprocesses on a CPU, this technique combines multiple operations into a single environment or context, instead of executing them sequentially and reading/writing temporary values to secondary memory after each one, since they do not share primary memory. Additionally, just as spawning subprocess involves overhead components, so too does a kernel, meaning fusion reduces these costs as well.</p>

<h3 id="gradient-checkpointing">Gradient Checkpointing</h3>
<p>Since bottlenecks are often caused by memory operations and leave computational units idle, we can use the gradient checkpointing strategy to reduce the amount of memory we use in return for increasing the amount of computations being done. In other words, instead of recording all of the data you need, record only a subset (checkpoints) and use it to redo the rest of the calculations as needed. It’s like the reverse of memoization, in which a program avoids recomputing values by saving them for reuse.</p>

<h2 id="demos">Demos</h2>

<h3 id="user-driven-kernel-fusion">User-Driven Kernel Fusion</h3>
<p>To simplify this process, consider the following conceptual example:</p>

<p>$$(5 + 3) * 10$$</p>

<p>To evaluate this expression, we could do the following</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_and_multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">c</span>
<span class="k">print</span><span class="p">(</span><span class="n">add_and_multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>In this example, we create a temporary variable to represent the intermediary result. Instead of allocating this memory to add and multiply separately, we can combine them into a single operation, removing the need to allocate memory and read/write to it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_and_multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>
<span class="k">print</span><span class="p">(</span><span class="n">add_and_multiply</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</code></pre></div></div>

<p>Comparing these two functions is a very simple way of illustrating what happens when kernels are fused in machine-learning tasks. While this example is small, the classic example for kernel fusion involves linear algebra and sequential matrix operations. Data for these operations can measure in gigabytes and utilize secondary memory.</p>

<h4 id="compiler-driven-kernel-fusion">Compiler-Driven Kernel Fusion</h4>
<p>While a developer can manually combine operations, this strategy is largely applied at a compiler level. Instead of applying optimizations directly to source code, IRs (intermediate representations) enable the transformation of high-level languages into a lower, hardware-agnostic form, while still retaining important semantic information from the original form. MLIR (Multi-Level Intermediate Representation) is a specific form or framework which makes use of fusion and is widely used for machine learning. Like the name suggests, MLIR allows code to be represented at varying levels of abstraction, each conducive to different optimizations<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p>

<p>Using MLIR, compilers can view code as a DAG (directed acyclic graph) which shows data dependencies within the program. With nodes in the graph representing operators, it reveals the flow of data from one operator to the next. When an operator immediately consumes the output from the one preceding it, it could be advantageous to fuse the operations rather than storing and subsequently collecting the data. Let’s take a look at a simple arithmetic example. Consider the expression:</p>

<p>$$a + b * c + 1$$</p>

<p>To keep things more accessible, let’s implement our own tiny IR just for this example. The signatures could look like this:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Node</span> <span class="p">{</span>
    <span class="kr">inline</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
    <span class="n">Node</span><span class="p">()</span> <span class="o">:</span> <span class="n">id</span><span class="p">(</span><span class="n">counter</span><span class="o">++</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Node</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">VarA</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">VarA</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">VarB</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">VarB</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">VarC</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">VarC</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Const</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">Const</span><span class="p">(</span><span class="kt">double</span> <span class="n">v</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Add</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
    <span class="n">Add</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">l</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Mult</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
    <span class="n">Mult</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">l</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">FusedOp</span> <span class="o">:</span> <span class="n">Node</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;&gt;</span> <span class="n">inputs</span><span class="p">;</span>
    <span class="k">explicit</span> <span class="n">FusedOp</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;&gt;</span> <span class="n">in</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>If we parse this expression into a DAG using our minimal IR, we could represent it like this:</p>

<p><img src="/airlab/preview/pr-5/images/other/blogs/computing-resources/before.png" alt="Before Fusion" title="Before Fusion"></p>

<p>From here, we can see the relationships between each term and apply a function to recursively traverse the tree. That could transform the original graph into the following:</p>

<p><img src="/airlab/preview/pr-5/images/other/blogs/computing-resources/after.png" alt="After Fusion" title="After Fusion"></p>

<p>Implementing this practice in a compiler removes the need to manually apply it to all operations and allows for further optimizations at a smaller level.</p>

<p>The complete code for this implementation can be found <a href="https://github.com/brankominick/fusion-demo">here</a>.</p>

<h3 id="gradient-checkpointing-1">Gradient Checkpointing</h3>
<p>Unlike kernel fusion, this method is more limited in its use cases but very applicable to the backwards passes in machine learning and AI training. Because it’s more specific to AI training, it can be found implemented at the framework level like in PyTorch<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>.</p>

<p>In order to do a short demonstration without abstracting away the logic, let’s put together a simple implementation and take some benchmarks. To account for storage, we compare saving each intermediate value with saving only some:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">compute_with_storage</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">depth</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">intermediates</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">intermediates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">intermediates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">intermediates</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">intermediates</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"  Storage used: "</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">fixed</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
              <span class="o">&lt;&lt;</span> <span class="n">memory_in_mb</span><span class="p">(</span><span class="n">intermediates</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
              <span class="o">&lt;&lt;</span> <span class="s">" MB</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">intermediates</span><span class="p">[</span><span class="n">depth</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To cut down on intermediates, instead of recording each one, we can update a variable and only record the checkpoints:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">depth</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">val</span> <span class="o">=</span> <span class="n">checkpoints</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>

        <span class="kt">int</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">checkpoint_interval</span><span class="p">,</span> <span class="n">depth</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">steps</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="n">val</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">checkpoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="n">steps</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>With an x value of 1.001 and a ridiculous depth of 2 billion, we get the following results:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Storage used: 15258.79 MB
Execution <span class="nb">time </span>with storage: 28.81s

K,Memory_MB,Time_s
10,1525.88,7.10
50,305.18,6.24
100,152.59,6.11
500,30.52,6.09
1000,15.26,6.10
5000,3.05,6.07
10000,1.53,6.05
50000,0.31,6.03
</code></pre></div></div>

<script src="https://d3js.org/d3.v7.min.js"></script>

<div id="chart"></div>
<div id="info-box" style="margin-top:20px; font-family:sans-serif;">
  <p>Hover over a point to see details.</p>
</div>
<script src="/airlab/preview/pr-5/assets/js/checkpoint-plot.js"></script>

<p>As we can see, adding checkpoints dramatically reduces not only the amount of memory used but also the total run time. However, the checkpoints have diminishing returns. As they become more frequent (as K decreases), the memory usage and execution time both increase. If we continue to decrease checkpoints (increase K), we would see slight increases to execution time in that direction as well.</p>

<p>The complete code for this implementation can be found <a href="https://github.com/brankominick/gradient-checkpointing-demo">here</a>.</p>

<h2 id="conclusion">Conclusion</h2>
<p>In this post, we deepened our understanding of kernel fusion and gradient checkpointing by implementing and visualizing them with simple demos. While each of these strategies brings its own optimizations, they also come with their own limitations, requiring careful consideration in how they’re implemented. Additionally, it’s important to remember that savings will compound when these techniques and others are applied in conjunction, resulting in higher utilization of compute units and thus, less wasted energy.</p>

<h2 id="reflection-and-future-direction">Reflection and Future Direction</h2>
<p>As noted in the conclusion, the strategies covered in this post have their limitations. Future work could include examining these bounds such as the payoff for fusion with complex kernels or how preferring primary memory may limit high-precision values. We could also explore other software-level optimization methods. Additionally, we could go in a more concrete direction and extend current frameworks like MLIR to execute and benchmark its current capabilities. Follow along to see what comes next!</p>

<h1 id="references-and-links">References and Links</h1>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Makin, Yashasvi, and Rahul Maliakkal. “Sustainable AI Training via Hardware–Software Co-Design on NVIDIA, AMD, and Emerging GPU Architectures.” <em>arXiv</em>, preprint arXiv:2508.13163, 28 July 2025, https://arxiv.org/abs/2508.13163. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>Chris Lattner, Mehdi Amini, Uday Bondhugula, Albert Cohen, Andy Davis, Jacques Pienaar, River Riddle, Tatiana Shpeisman, Nicolas Vasilache, and Oleksandr Zinenko. “MLIR: Scaling compiler infrastructure for domain specific computation.” In 2021 IEEE/ACM International Symposium on Code Generation and Optimization (CGO), pp. 2-14. IEEE, 2021. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>Paszke, Adam, et al. Automatic Differentiation in PyTorch. 2017, OpenReview, https://openreview.net/pdf?id=BJJsrmfCZ <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
  </ol>
</div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  <background></background>
  <dark></dark>
  <size></size>
-->


<div class="post-nav">
  <span>
    
      <i class="icon fa-solid fa-angle-left"></i> Previous post<br>
      <a href="/airlab/preview/pr-5/2025/09/20/computing-resources.html">
        Resource Efficiency and AI
      </a>
    
  </span>
  <span>
    
  </span>
</div>
  </section>


    </main>
    


<footer class="background" style="--image: url('/airlab/preview/pr-5/images/background.jpg')" data-dark="true" data-size="wide">
  <!--
    <div>
      Extra details like contact info or address
    </div>
  -->

  <div>
    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="mailto:contact@WCU-AIR.com" data-tooltip="Email" data-style="bare" aria-label="Email">
      <i class="icon fa-solid fa-envelope"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://orcid.org/0000-0001-8713-9213" data-tooltip="ORCID" data-style="bare" aria-label="ORCID">
      <i class="icon fa-brands fa-orcid"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://scholar.google.com/citations?user=ETJoidYAAAAJ" data-tooltip="Google Scholar" data-style="bare" aria-label="Google Scholar">
      <i class="icon fa-brands fa-google"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://github.com/WCU-AIR" data-tooltip="GitHub" data-style="bare" aria-label="GitHub">
      <i class="icon fa-brands fa-github"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://twitter.com/WCU-AIR" data-tooltip="Twitter" data-style="bare" aria-label="Twitter">
      <i class="icon fa-brands fa-twitter"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://youtube.com/WCU-AIR" data-tooltip="YouTube" data-style="bare" aria-label="YouTube">
      <i class="icon fa-brands fa-youtube"></i>
      
    </a>
  </div>


    
  </div>

  <div>
    © 2025
    WCU-AIR
      |   Built with
    <a href="https://github.com/greenelab/lab-website-template">
      Lab Website Template
    </a>
  </div>

  <input type="checkbox" class="dark-toggle" data-tooltip="Dark mode" aria-label="toggle dark mode" oninput="onDarkToggleChange(event)">
</footer>

  </body>
</html>
